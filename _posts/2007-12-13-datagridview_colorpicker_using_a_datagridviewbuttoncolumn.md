---
layout: post
title: DataGridView ColorPicker using a DataGridViewButtonColumn
date: 2007-12-13 20:41
author: chrispelatari
comments: true
categories: [Uncategorized]
---
It's not often that I get the opportunity to blog about something neat that I learned to do in <a href="http://windowsclient.net/">winforms</a> so you know I gotta, even tho it's not totally complete yet. Here's how I got a DataGridViewButtonColumn to act as a color picker.<br />
<br />
After a little bit of webernettin', I found a post by <a href="http://dotnetjunkies.com/WebLog/wardb/archive/2006/10/12/150262.aspx">Ward Bekker that describes how to handle the button click event of a DataGridViewButtonColumn</a>. Sweet. We'll get back to that code in a second.<br />
<br />
I want to have a special button that will display a rectangle of the selected color, so I created a class that derives from DataGridViewButtonCell. I want to be able to set the Color of the rectangle, and of course we have to paint the rectangle so we'll add a Color property of type Color (imagine that:) and override the Paint method.<br />
<br />
<pre style="border-style:solid;border-color:rgb(136,136,136) rgb(68,68,68) rgb(68,68,68) rgb(136,136,136);border-width:1px 2px 2px 1px;padding:6px;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,255);">public</span> ColorPickerCell : DataGridViewButtonCell{<br />  <span style="color:rgb(0,0,255);">const</span> <span style="color:rgb(0,0,255);">float</span> phi = 1.618f;<br /> <br />  <span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(43,145,175);">Color</span> colorValue;<br /> <br />  <span style="color:rgb(0,0,255);">public</span> <span style="color:rgb(43,145,175);">Color</span> <span style="color:rgb(43,145,175);">Color</span>{<br />    get{  <span style="color:rgb(0,0,255);">return</span> colorValue; }<br />    set{  colorValue = value; <br />      <span style="color:rgb(0,0,255);">this</span>.Value = value.ToArgb().ToString();<br />    }<br />  }<br /> <br />  <span style="color:rgb(0,0,255);">protected</span> <span style="color:rgb(0,0,255);">override</span> <span style="color:rgb(0,0,255);">void</span> Paint(<span style="color:rgb(43,145,175);">Graphics</span> graphics, <span style="color:rgb(43,145,175);">Rectangle</span> clipBounds, <br />    <span style="color:rgb(43,145,175);">Rectangle</span> cellBounds, <span style="color:rgb(0,0,255);">int</span> rowIndex, DataGridViewElementStates cellState,<br />    <span style="color:rgb(0,0,255);">object</span> value, <span style="color:rgb(0,0,255);">object</span> formattedValue, <span style="color:rgb(0,0,255);">string</span> errorText, <br />    DataGridViewCellStyle cellStyle, DataGridViewAdvancedBorderStyle<br />    advancedBorderStyle, DataGridViewPaintParts paintParts){<br />  <br />    <span style="color:rgb(0,128,0);">//CDF: draw the button</span><br />    <span style="color:rgb(0,0,255);">base</span>.Paint(graphics, clipBounds, cellBounds, rowIndex, cellState, value,     <br />    formattedValue, errorText, cellStyle, advancedBorderStyle, paintParts);<br /> <br />    <span style="color:rgb(0,128,0);">//CDF: draw a purty rectangle over the button</span><br />    <span style="color:rgb(0,0,255);">using</span>(<span style="color:rgb(43,145,175);">Pen</span> darkPen = <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">Pen</span>(<span style="color:rgb(43,145,175);">SystemColors</span>.ControlDark){<br />      <span style="color:rgb(43,145,175);">Rectangle</span> rc = <span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">Rectangle</span>(cellBounds.X + 8, cellBounds.Y + 3, <br />        cellBounds.Width - (<span style="color:rgb(0,0,255);">int</span>)(cellBounds.Width * phi / 8), <br />        cellBounds.Height - (<span style="color:rgb(0,0,255);">int</span>)(cellBounds.Height * phi / 4));<br /> <br />      graphics.FillRectangle(<span style="color:rgb(0,0,255);">new</span> <span style="color:rgb(43,145,175);">SolidBrush</span>(<span style="color:rgb(43,145,175);">Color</span>.FromArgb(<br />        <span style="color:rgb(0,0,255);">int</span>.Parse(formattedValue.ToString()))), rc);<br />      graphics.DrawRectangle(darkPen, rc);<br />    }<br />  }<br />}<br /></pre>
I also derived a class from DataGridViewButtonColumn (ColorPickerColumn), but I didn't really override anything. Anyway, now that we've got a button that will display a colored rectangle, we can add a ColorPickerColumn to a DataGridView on a Form. The next step is to handle the CellContentClick event as Ward indicated.<br />
<pre style="border-style:solid;border-color:rgb(136,136,136) rgb(68,68,68) rgb(68,68,68) rgb(136,136,136);border-width:1px 2px 2px 1px;padding:6px;background-color:rgb(248,248,248);"><span style="color:rgb(0,0,255);">private</span> <span style="color:rgb(0,0,255);">void</span> dataGridView1_CellContentClick(<span style="color:rgb(0,0,255);">object</span> sender, <br />  DataGridViewCellEventArgs e) {<br />  <br />  <span style="color:rgb(0,128,0);">//CDF: make sure we're on the right column. I used the name for this test.</span><br />  <span style="color:rgb(0,0,255);">if</span>(dataGridView1.Columns[e.ColumnIndex].Name == <span style="color:rgb(163,21,21);">"ColorColumn"</span>){<br /> <br />  ColorDialog dlg = <span style="color:rgb(0,0,255);">new</span> ColorDialog();<br /> <br />  ColorPickerCell currentCell = dataGridView1[e.ColumnIndex, e.RowIndex] <span style="color:rgb(0,0,255);">as</span><br />    ColorPickerCell;<br /> <br />  <span style="color:rgb(0,0,255);">if</span>(dlg.ShowDialog() == DialogResult.OK){<br />    <span style="color:rgb(0,0,255);">if</span>(currentCell != <span style="color:rgb(0,0,255);">null</span>){<br />      currentCell.<span style="color:rgb(43,145,175);">Color</span> = dlg.<span style="color:rgb(43,145,175);">Color</span>;<br />      <span style="color:rgb(0,0,255);">this</span>.Invalidate();<br />    }<br />  }<br />}<br /></pre>
Seems to do exactly what I want for now. Nice XD
